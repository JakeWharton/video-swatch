package=com.jakewharton.videoswatch.ffmpeg
headers=libavcodec/avcodec.h libavformat/avformat.h libavutil/imgutils.h libswscale/swscale.h
libraryPaths=/opt/homebrew/opt/ffmpeg/lib
compilerOpts=-I/opt/homebrew/opt/ffmpeg/include
linkerOpts=-L/opt/homebrew/opt/ffmpeg/lib -lavcodec -lavformat -lavutil -lswscale

---

static void avformat_close_input2(AVFormatContext* ref) {
	AVFormatContext* copy = ref;
	avformat_close_input(&copy);
}

static void avcodec_free_context2(AVCodecContext* ref) {
	AVCodecContext* copy = ref;
	avcodec_free_context(&copy);
}

typedef struct FrameSummary {
	long reds;
	long greens;
	long blues;
} FrameSummary;

static FrameSummary video_swatch_summarize_frame(AVFrame* frame, int32_t buffer_size) {
	FrameSummary summary;
	uint8_t color;
	uint8_t *data = frame->data[0];
	for (int i = 0; i < buffer_size; i += 4) {
		color = data[i];
		summary.reds += color * color;
		color = data[i + 1];
		summary.greens += color * color;
		color = data[i + 2];
		summary.blues += color * color;
	}
	return summary;
}
